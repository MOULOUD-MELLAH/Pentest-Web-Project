<?php 

?>
<!-- Purpose: Reusable component that displays the items in the database-->
<div class="container">
    <hr class="mb-3" />
    <h1 class="whiteFont mt-3">搜索项目:</h1>
    <!-- FORM -->
    <form method="GET" action="./admin.php">
        <div class="input-group mt-2 mb-3 w-50">
            <input type="text" class="form-control" placeholder="要搜索的项目名称" name="itemName">
            <div class="input-group-append">
                <!-- type=submit will trigger the form -->
                <button class="btn btn-outline-secondary" type="submit" id="searchItemBtn">Search</button>
            </div>
        </div>
    </form>
    <!-- END FORM -->
    <div class="card mb-5">
        <table class="table">
            <thead>
                <th>项目 ID</th>
                <th>所有者用户名</th>
                <th>标题</th>
                <th>描述</th>
                <th>价格</th>
                <th>删除</th>
            </thead>
            <tbody>
                <?php 
          // If the GET variable "itemName" is set then use it
          if(isset($_GET["itemName"])){
            $name = $_GET["itemName"];
            $sql = "SELECT * FROM items where ownersName LIKE '%$name%'";
          }else{
            // Otherwise just grab them all
            $sql = "SELECT * FROM items";                  
          } 

          $result = mysqli_query($db, $sql); 

          // Iterate through all results and create a list item
          while($row = mysqli_fetch_array($result)){
            
            echo "<tr>";
            // Access by name
            echo "<td>".$row["id"]."</td>";
            echo "<td>".$row["ownersName"]."</td>";
            echo "<td>".$row["title"]."</td>";
            echo "<td>".$row["description"]."</td>";
            echo "<td>".$row["price"]."</td>";
            
            // Add a button that sends the ID of the user to the delete function
            echo "<td>";
                echo "<button class='btn btn-danger' onclick='deleteItem(".$row["id"].")'><i class='fas fa-times'></button></i>";
            echo "</td>";
          }
          ?>
            </tbody>
        </table>
    </div>
</div>